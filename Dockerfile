FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IHYydgpkZXNjcmlwdGlvbjogSW1wb3J0IGEgdmlydHVhbCBtYWNo\
aW5lIGZyb20gVk13YXJlIGZvciBLdWJldmlydCB1c2luZyB2aXJ0LXYydgpiaW5kYWJsZTogRmFs\
c2UKYXN5bmM6IG9wdGlvbmFsCm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiBJbXBvcnQgYSB2bSBm\
cm9tIFZNd2FyZSB1c2luZyB2aXJ0LXYydiAoQVBCKQogIGltYWdlVXJsOiBodHRwczovL2Nkbi5w\
YnJkLmNvL2ltYWdlcy9INUd1dGQ3LnBuZwpwbGFuczoKICAtIG5hbWU6IGRlZmF1bHQKICAgIGRl\
c2NyaXB0aW9uOiBSZXRyaWV2ZSBWTSBmcm9tIHZtd2FyZQogICAgZnJlZTogVHJ1ZQogICAgbWV0\
YWRhdGE6IHt9CiAgICBwYXJhbWV0ZXJzOgogICAgICAtIHRpdGxlOiBPcGVuc2hpZnQgQWRtaW4g\
VXNlcgogICAgICAgIG5hbWU6IGFkbWluX3VzZXIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAg\
ICByZXF1aXJlZDogdHJ1ZQogICAgICAtIHRpdGxlOiBPcGVuc2hpZnQgQWRtaW4gUGFzc3dvcmQK\
ICAgICAgICBuYW1lOiBhZG1pbl9wYXNzd29yZAogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAg\
IHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgICAtIHRp\
dGxlOiBWTXdhcmUgdXJsIHRvIEVYU2kKICAgICAgICBuYW1lOiB1cmwKICAgICAgICB0eXBlOiBz\
dHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAtIHRpdGxlOiBWaXJ0dWFsIG1hY2hp\
bmUgbmFtZQogICAgICAgIG5hbWU6IHZtX25hbWUKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAg\
ICByZXF1aXJlZDogdHJ1ZQogICAgICAtIHRpdGxlOiBWTXdhcmUgQWRtaW4KICAgICAgICBuYW1l\
OiB1c2VybmFtZQogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAg\
ICAgICAgZGlzcGxheV90eXBlOiB1c2VybmFtZQogICAgICAtIHRpdGxlOiBWTXdhcmUgQWRtaW4g\
UGFzc3dvcmQKICAgICAgICBuYW1lOiBwYXNzd29yZAogICAgICAgIHR5cGU6IHN0cmluZwogICAg\
ICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAo="

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
RUN yum -y install libvirt-client curl qemu-img && yum clean all
USER apb
